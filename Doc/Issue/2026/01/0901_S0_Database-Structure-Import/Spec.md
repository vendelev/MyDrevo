# Спецификация: Импорт структуры базы данных из MySQL в SQLite

## Описание проблемы/потребности

В рамках учебного проекта по созданию сайта генеалогического древа необходимо импортировать существующую схему базы данных из формата MySQL в SQLite. Текущая структура базы данных представлена в файле `backend/database/migrations/structure.sql` и содержит все необходимые таблицы для функционирования системы. Поскольку проект использует SQLite как основную СУБД, требуется преобразовать существующую MySQL-схему в формат, совместимый с SQLite, и интегрировать её в систему миграций Laravel.

## Функциональные требования

1. Проанализировать существующий файл `structure.sql` с MySQL-схемой базы данных.
2. Преобразовать DDL-инструкции из MySQL-специфичного синтаксиса в синтаксис SQLite.
3. Создать новую миграцию Laravel, которая будет создавать все таблицы из исходной схемы.
4. Убедиться, что все ограничения (primary keys, unique constraints, indexes) корректно перенесены.
5. Проверить совместимость типов данных между MySQL и SQLite.
6. Обеспечить корректную работу внешних ключей в SQLite (включить поддержку foreign keys).
7. Создать миграцию, которая будет выполняться до всех остальных миграций проекта.

## Нефункциональные требования

- Производительность: Миграция должна выполняться менее чем за 5 секунд на типичной рабочей станции.
- Надежность: Процесс миграции должен быть идемпотентным и безопасным для повторного выполнения.
- Совместимость: Миграция должна корректно работать в окружении PHP 8.5.1 и Laravel 12.46.0.
- Поддержка: Код миграции должен соответствовать принятому в проекте стилю кодирования (CodeStyle.md).

## Модель предметной области

Основные сущности, выявленные из структуры базы данных:

- **Пользователь (gen_user)**: Владелец аккаунта в системе, имеет логин, пароль, ФИО, email.
- **Персона (gen_person)**: Узел генеалогического древа, имеет имя, фамилию, отчество, даты рождения и смерти.
- **Имя (gen_name, gen_name_lang)**: Справочник имён с поддержкой разных языков.
- **Фамилия (gen_surname, gen_surname_lang)**: Справочник фамилий с поддержкой разных языков.
- **Отношение (gen_relation)**: Связь между двумя персонами (родитель-ребёнок, супруги и т.д.).
- **Меню (gen_menu)**: Элементы навигационного меню с поддержкой многоязычности.
- **Сообщение (gen_message, gen_message_text)**: Системные сообщения с многоязычной поддержкой.
- **Права пользователя (gen_user_right)**: Справочник прав доступа.

## Зависимости

- Миграция зависит от корректной настройки подключения к SQLite в файле `backend/.env`.
- Процесс миграции должен быть совместим с системой управления миграциями Laravel.
- Миграция должна выполняться до любых миграций, которые ссылаются на таблицы из исходной схемы.

## Сценарии использования

1. **Сценарий: Развертывание проекта с нуля**
   - Разработчик клонирует репозиторий
   - Запускает `make install`
   - Система автоматически применяет миграцию с импортированной структурой
   - База данных SQLite создается с правильной схемой

2. **Сценарий: Обновление структуры базы данных**
   - Разработчик вносит изменения в `structure.sql`
   - Создает новую миграцию на основе обновленного файла
   - Применяет миграцию командой `php artisan migrate`

## Риски

1. **Потеря данных при конвертации**: Некоторые особенности MySQL (например, AUTO_INCREMENT, CHARSET) могут быть некорректно интерпретированы при конвертации.
2. **Ошибки типов данных**: Различия в системах типов MySQL и SQLite могут привести к ошибкам.
3. **Производительность индексов**: Индексы, оптимальные для MySQL, могут быть неоптимальны для SQLite.
4. **Ограничения SQLite**: Некоторые возможности MySQL (например, сложные ограничения) могут не поддерживаться SQLite.

## Критерии приемки

1. Файл миграции Laravel создан и находится в директории `database/migrations`.
2. Миграция успешно создает все таблицы из `structure.sql` при выполнении `php artisan migrate`.
3. Все первичные ключи, уникальные ограничения и индексы корректно перенесены.
4. Типы данных адекватно преобразованы (например, `int unsigned` → `integer`).
5. Поддержка внешних ключей включена в SQLite.
6. Миграция проходит успешно на чистой базе данных.
7. Миграция идемпотентна и безопасна для повторного выполнения.
8. Код миграции соответствует стандартам проекта (CodeStyle.md).

## Не входит в реализацию

- Перенос данных из существующей MySQL-базы в SQLite.
- Создание seed-данных для тестирования.
- Модификация структуры таблиц по сравнению с исходным `structure.sql`.
- Оптимизация производительности запросов.
- Реализация резервного копирования базы данных.