# Спецификация: Базовая структура и аутентификация

## Описание проблемы/потребности

Для разработки сайта генеалогического древа необходимо заложить фундамент приложения. Текущая потребность заключается в создании базового каркаса на Laravel, настройке базы данных и реализации системы управления доступом (регистрация, вход, выход). Это позволит пользователям создавать учетные записи и обеспечит безопасность их персональных данных в будущем.

## Функциональные требования

1.  **Инициализация проекта**: Развертывание структуры Laravel 12 в директории `backend/`.
2.  **Настройка БД**: Конфигурация SQLite для хранения данных пользователей.
3.  **Регистрация пользователей**:
    *   Форма регистрации с полями: Имя, Email, Пароль, Подтверждение пароля.
    *   Валидация данных (уникальность email, сложность пароля).
    *   Автоматический вход после успешной регистрации.
4.  **Аутентификация**:
    *   Форма входа (Email, Пароль).
    *   Механизм "Запомнить меня" (опционально, для удобства).
    *   Завершение сеанса (Logout).
5.  **Базовые страницы**:
    *   Главная страница (доступна всем).
    *   Страница входа (Login).
    *   Страница регистрации (Register).
    *   Личный кабинет/Dashboard (только для авторизованных).
6.  **Защита маршрутов**: Использование Middleware (`auth`) для ограничения доступа к внутренним разделам сайта.
7.  **Миграции**: Создание миграций для таблицы пользователей (`users`).

## Нефункциональные требования

1.  **Безопасность**:
    *   Хеширование паролей с использованием современных алгоритмов (BCRYPT/ARGON2).
    *   Защита от CSRF (Cross-Site Request Forgery).
    *   Защита от XSS при выводе данных.
    *   Четкое разделение между аутентифицированными и неаутентифицированными пользователями.
2.  **Производительность**: Время отклика сервера для базовых страниц не должно превышать 200 мс.
3.  **Usability**: Понятные сообщения об ошибках валидации на формах.
4.  **Архитектура**: Соблюдение модульной структуры в соответствии с `AGENTS.md` и `Architecture.md` (Clean Architecture, CQRS).
    *   Код должен быть организован в модуле `Auth`.
    *   Использование UseCase для бизнес-логики.
    *   Использование DTO для передачи данных.

## Модель предметной области

### Entity (Сущности)

*   **User**:
    *   `id`: UUID (Primary Key)
    *   `name`: String (Имя пользователя)
    *   `email`: String (Уникальный адрес почты)
    *   `password`: String (Хешированный пароль)
    *   `email_verified_at`: Timestamp (Дата подтверждения почты)

### Value Objects (Объекты-значения)

*   **Email**: Валидный адрес электронной почты.
*   **Password**: Строка, соответствующая требованиям безопасности.

## Зависимости

*   **Laravel Framework**: Основа приложения.
*   **SQLite**: СУБД для хранения данных.
*   **Composer**: Менеджер пакетов PHP.
*   **Docker**: Среда для запуска приложения (согласно `AGENTS.md`).
*   **Makefile**: Для управления командами разработки.

## Сценарии использования

### Сценарий 1: Регистрация нового пользователя

1.  Пользователь открывает страницу `/register`.
2.  Вводит свои данные (Имя, Email, Пароль, Подтверждение пароля).
3.  Система проверяет, что email не занят, пароли совпадают и соответствуют требованиям сложности.
4.  Система создает запись в таблице `users`.
5.  Пользователь автоматически входит в систему и перенаправляется на `/dashboard`.

### Сценарий 2: Вход в систему

1.  Пользователь открывает страницу `/login`.
2.  Вводит email и пароль.
3.  Система проверяет соответствие учетных данных.
4.  При успехе создается сессия, пользователь перенаправляется на `/dashboard`.

### Сценарий 3: Выход из системы

1.  Авторизованный пользователь нажимает кнопку "Выход".
2.  Система завершает сессию пользователя.
3.  Пользователь перенаправляется на страницу входа.

## Риски

1.  **Безопасность**: Неправильная настройка сессий или middleware может привести к несанкционированному доступу.
2.  **Окружение**: Возможные конфликты версий PHP/расширений в Docker контейнере (необходимо следовать `AGENTS.md`).
3.  **Интеграция**: Сложности с реализацией Clean Architecture в рамках стандартных механизмов аутентификации Laravel.

## Критерии приемки

1.  Приложение успешно запускается через `make up` и отображает главную страницу.
2.  Страницы регистрации и входа доступны по соответствующим маршрутам.
3.  Новые пользователи могут успешно зарегистрироваться.
4.  Существующие пользователи могут войти в систему.
5.  Защищенные маршруты (например, `/dashboard`) недоступны без аутентификации (перенаправление на `/login`).
6.  После выхода пользователь не имеет доступа к защищенным маршрутам.
7.  Пароли в базе данных хранятся в хешированном виде.
8.  Код организован согласно правилам `Architecture.md`.

## Не входит в реализацию

*   Восстановление пароля через email (запланировано на следующие этапы).
*   Подтверждение email (Email Verification).
*   Двухфакторная аутентификация.
*   Профили пользователей с расширенными данными (фото, биография).
*   Функционал самого генеалогического древа.
