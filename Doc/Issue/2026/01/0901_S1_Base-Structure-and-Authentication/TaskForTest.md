# План тестирования: Базовая структура и аутентификация

## Структура тестов
Тесты будут организованы в директории `backend/tests/Suite/Auth`:
- `Functional/`: Тесты UseCases (Application слой).
- `Integration/`: Тесты репозиториев и контроллеров (Infrastructure/Presentation слои).
- `E2E/`: Тесты полного цикла через HTTP запросы.

## Функциональные тесты (Application слой)

### UseCase: RegisterUser
- **Сценарий 1: Успешная регистрация**
    - **Дано**: Валидные данные (имя, email, пароль).
    - **Проверяемое**: Вызов `RegisterUser->execute()`.
    - **Ожидаемый результат**: Пользователь создан в БД, пароль захеширован, возвращен `UserResponse`.
- **Сценарий 2: Регистрация с существующим email**
    - **Дано**: Email, который уже есть в системе.
    - **Проверяемое**: Вызов `RegisterUser->execute()`.
    - **Ожидаемый результат**: Исключение `UserAlreadyExistsException`.

### UseCase: LoginUser
- **Сценарий 1: Успешный вход**
    - **Дано**: Корректные email и пароль.
    - **Проверяемое**: Вызов `LoginUser->execute()`.
    - **Ожидаемый результат**: Сессия создана, возвращен `UserResponse`.
- **Сценарий 2: Вход с неверным паролем**
    - **Дано**: Корректный email, неверный пароль.
    - **Проверяемое**: Вызов `LoginUser->execute()`.
    - **Ожидаемый результат**: Исключение `InvalidCredentialsException`.

## Integration тесты (Infrastructure слой)

### EloquentUserRepository
- **Сценарий 1: Сохранение и поиск пользователя**
    - **Дано**: Объект сущности `User`.
    - **Проверяемое**: `save()` и затем `findByEmail()`.
    - **Ожидаемый результат**: Данные в БД соответствуют сущности.

## E2E тесты (Presentation слой)

### Web Authentication Flow
- **Сценарий 1: Полный цикл регистрации и доступа к Dashboard**
    - **Дано**: Гость на странице `/register`.
    - **Проверяемое**: Отправка формы регистрации -> Редирект на `/dashboard` -> Доступ разрешен.
    - **Ожидаемый результат**: Статус 200 на Dashboard, сессия активна.
- **Сценарий 2: Защита Dashboard от гостей**
    - **Дано**: Неавторизованный пользователь.
    - **Проверяемое**: Запрос GET `/dashboard`.
    - **Ожидаемый результат**: Редирект на `/login`.

## Чек-лист выполнения
- [ ] Запуск всех тестов: `make php-run CMD="php artisan test"`
- [ ] Запуск только тестов Auth: `make php-run CMD="php artisan test tests/Suite/Auth"`

## Критерии приемки
1. Новые пользователи могут успешно зарегистрироваться.
2. Существующие пользователи могут войти в систему.
3. Защищенные маршруты недоступны без аутентификации.
4. Пароли в базе данных хранятся в хешированном виде.
5. Все тесты проходят успешно.
