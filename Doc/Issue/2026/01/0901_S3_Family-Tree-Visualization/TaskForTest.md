# План тестирования: Визуализация семейного дерева (Этап 3)

## 1. Стратегия тестирования
- **Unit-тесты:** Тестирование `TreeBuilderService` на корректность формирования графа (узлы, связи) и отсутствие бесконечных циклов.
- **Integration-тесты:** Тестирование API эндпоинта с реальной (тестовой) базой данных SQLite.
- **E2E-тесты (Manual/Automated):** Проверка визуального отображения и интерактивности на фронтенде.

## 2. Тест-кейсы (Backend)

### TC-B1: Получение дерева для существующей персоны
- **Предусловие:** В БД создана семья (Отец, Мать, Ребенок).
- **Действие:** `GET /api/v1/family-tree/{child_id}`.
- **Ожидаемый результат:**
    - HTTP 200.
    - JSON содержит 3 узла и 2 связи типа `parent-child`.
    - Данные ФИО и дат жизни соответствуют БД.

### TC-B2: Ограничение глубины (depth)
- **Предусловие:** Цепочка предков из 5 поколений.
- **Действие:** `GET /api/v1/family-tree/{id}?depth=2`.
- **Ожидаемый результат:** В ответе только персоны на расстоянии не более 2 шагов от корня.

### TC-B3: Обработка циклов
- **Предусловие:** В БД создана циклическая связь (ошибка данных).
- **Действие:** Запрос дерева.
- **Ожидаемый результат:** Сервис не уходит в бесконечную рекурсию, возвращает корректный граф или ошибку валидации данных.

### TC-B4: Права доступа
- **Предусловие:** Пользователь A пытается запросить дерево для персоны из семьи, к которой у него нет доступа.
- **Действие:** `GET /api/v1/family-tree/{alien_id}`.
- **Ожидаемый результат:** HTTP 403 Forbidden.

## 3. Тест-кейсы (Frontend)

### TC-F1: Рендеринг графа
- **Действие:** Загрузка страницы дерева.
- **Ожидаемый результат:** Узлы отображаются, связи отрисованы линиями, пол визуально различим.

### TC-F2: Интерактивность (Zoom/Pan)
- **Действие:** Использование колесика мыши и перетаскивание.
- **Ожидаемый результат:** Масштаб меняется плавно, холст перемещается.

### TC-F3: Карточка-превью
- **Действие:** Клик по узлу.
- **Ожидаемый результат:** Появляется всплывающее окно с краткой информацией. Кнопка "Подробнее" ведет на `/family-members/{id}`.

### TC-F4: Смена ориентации
- **Действие:** Нажатие кнопки переключения вида.
- **Ожидаемый результат:** Граф перестраивается (например, из вертикального в горизонтальный).

## 4. Инструменты
- **Backend:** PHPUnit.
- **Frontend:** Jest / React Testing Library (для логики), ручное тестирование (для визуализации).
