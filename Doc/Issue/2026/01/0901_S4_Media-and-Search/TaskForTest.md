# План тестирования: Добавление медиа и поиск

## Стратегия тестирования
Тестирование будет включать Unit-тесты для бизнес-логики, интеграционные тесты для работы с файловой системой и БД, а также E2E тесты для API эндпоинтов.

## Объекты тестирования

### 1. Media Module
- **Unit-тесты**:
    - Валидация типов файлов (разрешенные расширения).
    - Логика определения типа медиа (image vs document).
- **Интеграционные тесты**:
    - Загрузка файла в `Storage` (проверка существования файла после загрузки).
    - Создание превью (проверка, что файл превью создается и является изображением).
    - Удаление файла (проверка удаления из `Storage` и БД).
    - Установка основного фото (проверка сброса флага у других фото того же владельца).
- **API тесты**:
    - `POST /api/v1/family-members/{id}/media` (успех, ошибка валидации, ошибка размера).
    - `DELETE /api/v1/media/{id}` (успех, 404).

### 2. Search Module
- **Unit-тесты**:
    - Сборка объекта `SearchCriteria` из массива параметров.
- **Интеграционные тесты**:
    - Поиск по ФИО (полное и частичное совпадение).
    - Фильтрация по году рождения/смерти.
    - Фильтрация по полу и месту.
    - Комбинированные фильтры.
- **API тесты**:
    - `GET /api/v1/search` с различными наборами параметров.

## Тестовые сценарии (Примеры)

| ID | Описание | Ожидаемый результат |
|---|---|---|
| MED-1 | Загрузка валидного JPG изображения | Файл сохранен, создан thumbnail, запись в БД создана |
| MED-2 | Загрузка PHP файла под видом документа | Ошибка валидации (422), файл не сохранен |
| MED-3 | Удаление медиафайла | Файл удален из диска, запись удалена из БД |
| SRCH-1 | Поиск "Иван" при наличии "Иван Иванов" | В результатах есть "Иван Иванов" |
| SRCH-2 | Фильтр по году 1900 | Возвращаются только люди, рожденные/умершие в 1900 |

## Инструменты
- **PHPUnit**: Основной фреймворк тестирования.
- **Laravel Storage Fake**: Для имитации файловой системы.
- **Faker**: Для генерации тестовых данных.

## Критерии успешного тестирования
- [ ] Все тесты проходят успешно (`make php-run CMD="php artisan test"`).
- [ ] Покрытие кода тестами для новых UseCases не менее 90%.
- [ ] Отсутствие утечек файлов в `storage/app/public/media` после тестов.
