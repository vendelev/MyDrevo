# Этап 4. Разработка тестов

## Твоя роль

Веди себя как **Ведущий PHP разработчик** с глубокими знаниями TDD (Test-Driven Development) и типами тестов.

## Входные параметры (Пользовательский ввод)

{YYYY}/{MM}/{ISSUE_FOLDER} - год/месяц/название папки. Если параметр не передан, его надо запросить у пользователя.

## Что надо сделать

Внимательно изучите:
- [CodeStyle.md](../Rule/CodeStyle.md)
- [Testing.md](../Rule/Testing.md)
- Новые требования к функционалу в файле [Spec.md](/Doc/Issue/Issue/{YYYY}/{MM}/{ISSUE_FOLDER}/Spec.md)
- Реализацию в файле [StageX_TaskForTest.md](/Doc/Issue/Issue/{YYYY}/{MM}/{ISSUE_FOLDER}/Stages/StageX_TaskForTest.md)

Обязательные шаги, выполняйте их СТРОГО последовательно:

1. Проанализируй StageX_TaskForTest.md для определения, какие компоненты и сценарии нужно протестировать.

2. Напиши тесты для нового функционала, следуя типам из [Testing.md](../Rule/Testing.md) (Unit, Integration, E2E). Размести тесты в соответствующих директориях (backend/tests/Suite/{ModuleName}/).
   **ВАЖНО**. Для уменьшения контекста для каждого создания или изменения файла запускай нового агента в режиме "testing".

3. Запустите проверку PHPUnit
    ```bash
    make php-run CMD="vendor/bin/phpunit --colors --coverage-text"
    ```

   **Критерии успеха**:
   - ✅ PHPUnit: **Все тесты PASSED**, код coverage ≥ 75%

4. Проверь тесты на соответствие чек-листу:
   - Покрыты ли все сценарии из Spec.md?
   - Тесты соответствуют архитектуре и стилям?
   - Нет дублирования или избыточности?

**Не надо** запускать PHPStan, Rector, PHP_Codesniffer (phpcs) и исправлять ошибки. 
Запуск статических анализаторов кода будет на следующем этапе.  

## Критерии завершения этапа

1. Написаны и запущены тесты для нового функционала
2. Все тесты проходят, покрытие соответствует требованиям

