# Этап 4. Разработка тестов

## Твоя роль

Веди себя как **Ведущий PHP разработчик** с глубокими знаниями TDD (Test-Driven Development) и типами тестов.

## Входные параметры (Пользовательский ввод)

{YYYY}/{MM}/{ISSUE_FOLDER} - год/месяц/название папки. Если параметр не передан, его надо запросить у пользователя.

## Что надо сделать

Внимательно изучи:
- [CodeStyle.md](../Rule/CodeStyle.md)
- [Testing.md](../Rule/Testing.md)
- Новые требования к функционалу в файле [Spec.md](/Doc/Issue/Issue/{YYYY}/{MM}/{ISSUE_FOLDER}/Spec.md)
- Реализацию в файле [StageX_TaskForTest.md](/Doc/Issue/Issue/{YYYY}/{MM}/{ISSUE_FOLDER}/Stages/StageX_TaskForTest.md)

Обязательные шаги:

1. Проанализируй StageX_TaskForTest.md для определения, какие компоненты и сценарии нужно протестировать.

2. Напиши тесты для нового функционала, следуя типам из [Testing.md](../Rule/Testing.md) (Unit, Integration, E2E). Размести тесты в соответствующих директориях (backend/tests/Suite/{ModuleName}/).

3. Запусти автоматические инструменты исправления кода и стиля
    ```bash
    # 1. Rector - Автоматическое улучшение кода (рефакторинг, модернизация)
    make php-run CMD="vendor/bin/rector process"

    # 2. PHPCBF - Автоматическое исправление стиля кода
    make php-run CMD="vendor/bin/phpcbf"
    ```

   **Критерии успеха**:
    - ✅ Rector: Код рефакторирован и изменен автоматически
    - ✅ PHPCBF: Стиль кода автоматически исправлен в соответствии с файлом конфигурации

4. Запусти проверку качества кода
   ```bash
   # 1. PHPStan - Проверка типов
   make php-run CMD="vendor/bin/phpstan analyse --memory-limit=256M"

   # 2. Rector - Проверка рефакторинга и модернизации
   make php-run CMD="vendor/bin/rector process --dry-run"

   # 3. PHP_CodeSniffer - Проверка кодстиля
   make php-run CMD="vendor/bin/phpcs --colors"
   ```

   **Критерии успеха**:
    - ✅ PHPStan: **0 ошибок**
    - ✅ Rector: **OK**
    - ✅ PHP_CodeSniffer: **0 нарушений**

5. Запусти проверку PHPUnit
    ```bash
    # 1. PHPUnit - Запуск всех тестов
    make php-run CMD="vendor/bin/phpunit --colors --coverage-text"
    ```

    **Критерии успеха**:
    - ✅ PHPUnit: **Все тесты PASSED**, код coverage ≥ 75%

6. Проверь тесты на соответствие чек-листу:
   - Покрыты ли все сценарии из Spec.md?
   - Тесты соответствуют архитектуре и стилям?
   - Нет дублирования или избыточности?

## Критерии завершения этапа

1. Написаны и запущены тесты для нового функционала
2. Все тесты проходят, покрытие соответствует требованиям
3. PHPStan: не выводит ошибок
4. Rector: не выводит ошибок
5. PHP_CodeSniffer: не выводит ошибок

## Ревью пользователем тестов

Если ревю прошло → перейти к коммиту. Если нет → исправить тесты и повторить проверки.

## Коммит изменений в git

Комментарий должен быть на русском языке
