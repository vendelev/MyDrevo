# Этап <X>. <Краткое название> — план для тестирования

## Цель этапа

- Что проверяем в этом этапе: …
- Какие критерии приемки закрываем: …

## Общие принципы тестирования

- Типы тестов: Unit, Integration, E2E.
- Разделяй ответственность тестов:
  - Unit — доменные правила/DTO/валидации без внешних зависимостей.
  - Integration — связка команд/запросов/репозиториев с БД.
  - E2E — HTTP-флоу от роутинга до ответа.
- Каждый сценарий описывай в формате: **Дано → Проверяемое → Ожидаемый результат**.

## Структура тестовых файлов

> Укажи точные пути и назначение.

Unit:

- `backend/tests/Suite/<ModuleName>/Domain/...Test.php` — …
- `backend/tests/Suite/<ModuleName>/Application/...Test.php` — …

Integration:

- `backend/tests/Suite/<ModuleName>/Integration/...Test.php` — …

E2E:

- `backend/tests/Suite/<ModuleName>/E2E/...Test.php` — …

## Сценарии

### Unit

1. **<Название сценария>**
   - Дано: …
   - Проверяемое: …
   - Ожидаемый результат: …

### Integration

1. **<Название сценария>**
   - Дано: …
   - Проверяемое: …
   - Ожидаемый результат: …

### E2E

1. **<Название сценария>**
   - Дано: …
   - Проверяемое: …
   - Ожидаемый результат: …

## Матрица покрытия требований

> Сопоставь критерии приемки из Spec.md с тестами.

- AC-1: … → `<TestClass>::<testMethod>()`
- AC-2: … → `<TestClass>::<testMethod>()`

## Чек-лист выполнения (локально/CI)

- `make php-run CMD="php artisan test"`
- `make php-run CMD="vendor/bin/phpstan analyse"` (если включено в пайплайн)

## Диаграмма тестируемого потока (Mermaid)

> Диаграмма помогает тестировщику быстро понять, где проверять эффекты (БД/ответ/сайд-эффекты).

```mermaid
flowchart TD
  T[Test] --> HTTP[HTTP Request]
  HTTP --> C[Controller]
  C --> UC[UseCase]
  UC --> R[(Repository)]
  R --> DB[(SQLite)]
  UC --> RES[HTTP Response]
  RES --> A[Assertions]
```

## Общие рекомендации

- Используй фабрики/фикстуры из проекта (если есть).
- Фиксируй время (если важно) и избегай флакки-тестов.
- Для E2E — проверяй не только статус-код, но и payload/контент.
