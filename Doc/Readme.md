# Мультиагентная разработка

***

## Общение

Все ответы и взаимодействие на **русском языке**.

***

## Общая концепция

Система состоит из команды специализированных агентов, координируемых оркестратором. 
Каждый агент выполняет определённую роль в процессе разработки. 
Оркестратор управляет последовательностью работы, передаёт результаты между агентами и останавливает процесс при возникновении блокирующих вопросов.

***

## Роли агентов

### Оркестратор

**Функция:** 

- Координация всего процесса разработки
- Ставит задачи другим агентам
- Принимает и анализирует результаты
- Определяет следующие шаги
- Останавливает процесс при блокирующих вопросах
- Управляет циклами review-доработка

### Product Owner

**Функция:** [Описание бизнес потребностей и планирование этапов эпика](/Doc/Mode/Stage0CreateEpic.md) 

### Бизнес аналитик

**Функция:** [Создание спецификации с описанием бизнес-требований](/Doc/Mode/Stage1CreateSpec.md)

### Системный аналитик + IT архитектор

**Функция:** [Формирование технического плана для разработки кода и тестов](/Doc/Mode/Stage2CreatePlan.md)

### PHP разработчик

**Функция:** [Разработка программного кода](/Doc/Mode/Stage3Implementation.md)

### Разработчик тестов

**Функция:** [Разработка тестов](/Doc/Mode/Stage4Testing.md)

### Технический писатель

**Функция:** [Создание технической документации](/Doc/Mode/Stage5TechDoc.md)

### IT архитектор

**Функция:** [Создание архитектурной документации](/Doc/Mode/Stage6ArchDoc.md)

***

## Последовательность работы

На каждом этапе мультиагентной разработки шаги работы с агентами будут одинаковы:

1. Создаем новый контекст в режиме "orchestrator" и пишем ему команду (см описание каждого этапа).
2. Проводим ревью, вносим правки самостоятельно или даем команду на исправление агенту.
3. Делаем коммит самостоятельно или даем команду: `сделай коммит`.
   Команду агенту надо давать в самой первой задаче для "orchestrator", чтобы агент смог правильно составить комментарий к коммиту.

Список этапов:

### Этап 0. Описание бизнес потребностей и планирование этапов эпика.

Создаем новый контекст в режиме "orchestrator" и пишем следующую команду:

```markdown
1. В режиме "create-epic" нужно создать описание бизнес-потребностей.
   Номер эпика: {номер эпика из трекера}.
   Описание потребностей: {.......}
   Запущенный агент должен вернуть список созданных или измененных файлов для последующей проверки.
2. По окончанию работы запущенного агента надо запустить нового агента в режиме "create-epic".
   Дать ему команду: "Перепроверь созданные файлы {список файлов} на соответствие своим инструкциям".
   Запущенный агент должен вернуть список файлов и список замечаний для каждого файла.
3. Если найдены замечания, то запусти нового агента в режиме "create-epic", чтобы он внес правки. 
   Для уменьшения контекста каждому агента надо давать задание по изменению только одного файла.
```

### Этап 1. Создание спецификации с описанием бизнес-требований.

Создаем новый контекст в режиме "orchestrator" и пишем следующую команду:

```markdown
1. В режиме "create-spec" нужно создать описание бизнес-требований.
   Номер задачи: {номер задачи из трекера}.
   {Если выполнялся Этап 0, то пишем: Описание этика находится в файле/Doc/Backlog/{YYYY}/{EPIC_FOLDER}/Summary.md. Нужно создать описание бизнес-требований для этапа {Х} согласно инструкциям.} 
   {Если доработка небольшая и формирование эпика не требуется, то пишем: Описание бизнес-потребностей: .....}
   Запущенный агент должен вернуть список созданных или измененных файлов для последующей проверки.
2. По окончанию работы запущенного агента надо запустить нового агента в режиме "create-spec".
   Дать ему команду: "Перепроверь созданные файлы {список файлов} на соответствие своим инструкциям".
   Если найдены замечания, запущенный агент должен вернуть список замечаний для каждого файла, который нужно исправить.
3. Если найдены замечания, то запусти нового агента в режиме "create-spec", чтобы он внес правки. 
   Для уменьшения контекста каждому агента надо давать задание по изменению только одного файла.
```

### Этап 2. Формирование технического плана для разработки.

**Рекомендация**:
```
Создавайте технический план непосредственно перед разработкой.
Создание плана "на будущее" приводит к тому, что после реализации текущего этапа приходится пересматривать план разработки следующего этапа.
```

Создаем новый контекст в режиме "orchestrator" и пишем следующую команду:

```markdown
1. В режиме "create-plan" нужно на основе бизнес требований из файла /Doc/Issue/{YYYY}/{MM}/{ISSUE_FOLDER}/Spec.md создать план по разработке коди и тестов согласно инструкциям.
   Запущенный агент должен вернуть список созданных или измененных файлов для последующей проверки.
2. По окончанию работы запущенного агента надо запустить нового агента в режиме "create-plan".
   Дать ему команду: "Перепроверь созданные файлы {список файлов} на соответствие своим инструкциям".
   Если найдены замечания, запущенный агент должен вернуть список замечаний для каждого файла, который нужно исправить.
3. Если найдены замечания, то запусти нового агента в режиме "create-plan", чтобы он внес правки. 
   Для уменьшения контекста каждому агента надо давать задание по изменению только одного файла.
```

### Этап 3. Разработка программного кода и тестов.

**Рекомендация**: 
```
Выполняйте каждый этап реализации {X} разработки кода и тестов по отдельности.
Это позволяет упростить ревью кода и обнаружить ошибки реализации как можно раньше.
```

1. Создаем новый контекст в режиме "orchestrator" и пишем следующую команду:

   ```markdown
   1. В режиме "implementation" нужно разработать код для этапа реализации {X} из файла /Doc/Issue/{YYYY}/{MM}/{ISSUE_FOLDER}/Task.md согласно инструкциям.
      Запущенный агент должен вернуть список созданных или измененных файлов для последующей проверки.
   2. По окончанию работы запущенного агента надо запустить нового агента в режиме "implementation".
      Дать ему команду: "Перепроверь созданные файлы {список файлов} на соответствие своим инструкциям".
      Если найдены замечания, запущенный агент должен вернуть список замечаний для каждого файла, который нужно исправить.
   3. Если найдены замечания, то запусти нового агента в режиме "implementation", чтобы он внес правки. 
      Для уменьшения контекста каждому агента надо давать задание по изменению только одного файла.
   ```
2. Проводим ревью, вносим правки самостоятельно или даем команду на исправление агенту.
3. Делаем коммит самостоятельно или даем команду: `сделай коммит`.

4. Создаем новый контекст в режиме "orchestrator".
   Пишем следующую команду:

   ```markdown
   1. В режиме "testing" нужно разработать тесты для этапа реализации {X} из файла /Doc/Issue/{YYYY}/{MM}/{ISSUE_FOLDER}/Task.md согласно инструкциям.
      Запущенный агент должен вернуть список созданных или измененных файлов для последующей проверки.
   2. По окончанию работы запущенного агента надо запустить нового агента в режиме "implementation".
      Дать ему команду: "Перепроверь созданные файлы {список файлов} на соответствие своим инструкциям".
      Если найдены замечания, запущенный агент должен вернуть список замечаний для каждого файла, который нужно исправить.
   3. Если найдены замечания, то запусти нового агента в режиме "implementation", чтобы он внес правки. 
      Для уменьшения контекста каждому агента надо давать задание по изменению только одного файла.
   ```
5. Проводим ревью, вносим правки самостоятельно или даем команду на исправление агенту.
6. Делаем коммит самостоятельно или даем команду: `сделай коммит`.

7. В файле /Doc/Issue/{YYYY}/{MM}/{ISSUE_FOLDER}/Task.md сделать пометку у этапа реализации {X}, что он выполнен.

**Пункты 1-7 повторяем** пока не будут выполнены все этапы реализации описанные в файле /Doc/Issue/{YYYY}/{MM}/{ISSUE_FOLDER}/Task.md.

### Этап 5. Создание технической документации.

Создаем новый контекст в режиме "orchestrator" и пишем следующую команду:

```markdown
1. В режиме "tech-doc" нужно на основе бизнес требований и плана по разработке коди и тестов в папке /Doc/Issue/{YYYY}/{MM}/{ISSUE_FOLDER} создать техническую документацию согласно инструкциям.
   Запущенный агент должен вернуть список созданных или измененных файлов для последующей проверки.
2. По окончанию работы запущенного агента надо запустить нового агента в режиме "tech-doc".
   Дать ему команду: "Перепроверь созданные файлы {список файлов} на соответствие своим инструкциям".
   Если найдены замечания, запущенный агент должен вернуть список замечаний для каждого файла, который нужно исправить.
3. Если найдены замечания, то запусти нового агента в режиме "tech-doc", чтобы он внес правки. 
   Для уменьшения контекста каждому агента надо давать задание по изменению только одного файла.
```

### Этап 6. Создание архитектурной документации.

Создаем новый контекст в режиме "orchestrator" и пишем следующую команду:

```markdown
1. В режиме "arch-doc" нужно на основе бизнес требований и плана по разработке коди и тестов в папке /Doc/Issue/{YYYY}/{MM}/{ISSUE_FOLDER} создать техническую документацию согласно инструкциям.
   Запущенный агент должен вернуть список созданных или измененных файлов для последующей проверки.
2. По окончанию работы запущенного агента надо запустить нового агента в режиме "arch-doc".
   Дать ему команду: "Перепроверь созданные файлы {список файлов} на соответствие своим инструкциям".
   Если найдены замечания, запущенный агент должен вернуть список замечаний для каждого файла, который нужно исправить.
3. Если найдены замечания, то запусти нового агента в режиме "arch-doc", чтобы он внес правки. 
   Для уменьшения контекста каждому агента надо давать задание по изменению только одного файла.
```
