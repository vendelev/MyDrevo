# Этап 4. Безопасность, журналирование и ограничения экспорта

## 1. Название этапа и его краткое описание

Усиливаем контроль и прозрачность экспорта: вводим журналирование действий, ограничения на частоту/объём, а также уточняем требования безопасности и приватности.

## 2. Цель этапа

Минимизировать риски утечки данных и деградации производительности при активном использовании экспорта.

## 3. Функциональные требования

1. Система ведёт журнал событий экспорта:
   - кто инициировал экспорт;
   - когда инициировал;
   - параметры экспорта (формат/состав, если применимо);
   - результат выполнения (успех/ошибка);
   - кто и когда скачивал файл.
2. Для пользователя доступна история экспортов (минимально: список последних N экспортов со статусами и датами).
3. Система ограничивает частоту запусков экспорта (например, не чаще X раз в Y минут).
4. Система ограничивает хранение результатов по количеству (например, не более N готовых экспортов одновременно).
5. При превышении ограничений пользователь получает понятное сообщение (что произошло и что делать).

## 4. Нефункциональные требования

- **Безопасность**:
  - все операции экспорта доступны только владельцу данных;
  - файл экспорта не доступен по «угадываемым» ссылкам;
  - при скачивании выполняется проверка прав доступа.
- **Соответствие приватности**:
  - экспорт не включает технические и секретные данные;
  - состав экспорта документирован.
- **Наблюдаемость**:
  - журнал позволяет расследовать инциденты (кто/когда делал экспорт и скачивание).

## 5. Сценарии использования

1. **Пользователь видит историю экспортов**
   - Пользователь открывает раздел экспорта.
   - Видит список экспортов: даты, статусы, формат.

2. **Пользователь превышает лимит**
   - Пользователь часто нажимает «Экспортировать данные».
   - Система сообщает, что достигнут лимит, и предлагает подождать.

3. **Расследование инцидента**
   - Администратор/поддержка (в рамках полномочий) анализирует журнал: кто создавал и скачивал экспорт.

## 6. Критерии приемки

1. Все события из раздела 3.1 фиксируются в журнале.
2. Пользователь видит историю экспортов (минимум последние N).
3. Ограничения частоты и количества работают и дают понятные сообщения.
4. Попытка доступа к чужому экспорту блокируется.

## 7. Зависимости

- Этап 2 (как минимум наличие сущности/процесса экспорта со статусом и хранением).
- Требования к ролям и доступу (если предусматривается доступ админа к журналам).

## 8. Оценка трудозатрат

8–14 часов
