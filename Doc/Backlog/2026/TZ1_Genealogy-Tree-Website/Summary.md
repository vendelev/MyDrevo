# TZ1 — Веб‑сайт семейного генеалогического древа

## 1. Название эпика и его краткое описание

**Эпик:** TZ1 — Веб‑сайт семейного генеалогического древа.

**Кратко:** создать веб‑сайт, на котором пользователь может просматривать и управлять семейным деревом. В проекте уже есть заготовка структуры базы данных, оставшаяся от прошлой разработки: [`backend/database/migrations/structure.sql`](../../../../backend/database/migrations/structure.sql).

## 2. Бизнес-цель и ценность

**Бизнес-цель:** получить работающий веб‑продукт для ведения семейного генеалогического древа, который можно демонстрировать стейкхолдерам поэтапно и развивать дальше.

**Ценность:**

- Пользователь получает единое место для хранения и визуализации информации о родственниках и связях.
- Проект получает понятный «скелет» продукта: от импорта существующей схемы данных до базовых пользовательских сценариев.
- Снижается риск «перепридумывания» модели данных: используем существующую структуру как отправную точку.

## 3. Основные заинтересованные стороны

- **Конечные пользователи:** люди, которые хотят вести семейное древо (частные лица).
- **Администратор/владелец дерева:** пользователь, который создает и редактирует данные.
- **Стейкхолдеры проекта (заказчик/куратор учебного проекта):** оценивают прогресс по промежуточным результатам.
- **Команда разработки:** backend (Laravel, CQRS), в перспективе frontend.

## 4. Функциональные требования

### 4.1. Базовые сценарии продукта

- Система должна позволять **просматривать** семейное древо (минимум: список персон и их связи; далее — визуализация).
- Система должна позволять **добавлять/редактировать** персону (ФИО, даты рождения/смерти, описание).
- Система должна позволять **создавать связи** между персонами (тип связи определяется справочником/типом).
- Система должна позволять **управлять доступом** к данным (минимум: авторизация и разграничение «свой/чужой» набор данных).

### 4.2. Требования, связанные с существующей БД

- Система должна использовать существующую структуру данных из [`backend/database/migrations/structure.sql`](../../../../backend/database/migrations/structure.sql) как основу.
- Система должна обеспечить **воспроизводимое развертывание** схемы БД в текущем стеке проекта (Laravel миграции + SQLite), даже если исходный файл содержит SQL под другую СУБД.
- Система должна иметь документированное соответствие: какие сущности/таблицы используются в MVP и как они отображаются на доменные понятия (персона, имя, фамилия, связь, пользователь).

## 5. Нефункциональные требования

- **Понятность для нетехнического пользователя:** интерфейс и тексты должны быть простыми.
- **Безопасность:**
  - доступ к данным только после авторизации;
  - пользователь не должен видеть/редактировать данные другого пользователя.
- **Надежность:** операции создания/редактирования должны быть атомарными.
- **Производительность (MVP):**
  - загрузка списка персон и связей для одного дерева должна быть приемлемой для сотен записей;
  - API должно отвечать стабильно в рамках локального/учебного окружения.
- **Поддерживаемость:** следовать принятой архитектуре (Clean Architecture + CQRS) и стилю проекта.
- **Контейнеризация:** запуск через Docker/Makefile без ручной настройки окружения.

## 6. Критерии успеха

- Можно развернуть проект и получить работающий сайт/страницы, демонстрирующие семейное древо.
- **Формат MVP:** допускаются оба варианта реализации пользовательского интерфейса:
  - Blade-страницы (Laravel web routes) как основной вариант;
  - либо API + простые страницы/клиент (если это ускоряет демонстрацию), при условии что пользовательские сценарии из требований выполняются.
- Есть минимальный набор пользовательских сценариев: вход, создание персоны, создание связи, просмотр результата.
- Схема БД воспроизводимо поднимается в текущем окружении проекта.
- Промежуточные результаты можно показывать стейкхолдерам после каждого этапа.

## 7. Риски и ограничения

- **Несовместимость SQL:** файл [`backend/database/migrations/structure.sql`](../../../../backend/database/migrations/structure.sql) выглядит как SQL под MySQL (например, `auto_increment`, `charset=utf8`), а проект использует SQLite. Потребуется адаптация/перенос в миграции.
- **Неполнота схемы:** в файле может не хватать таблиц/ограничений/справочников для полноценного дерева.
- **Неясность доменной модели:** названия таблиц и полей могут не совпадать с желаемыми доменными терминами.
- **Риски качества данных:** отсутствие внешних ключей/ограничений может приводить к «битым» связям.
- **Ограничение учебного проекта:** приоритет — демонстрируемый результат, а не идеальная полнота функционала.

## 8. Зависимости

- Текущий стек проекта: Laravel 12 + Docker + SQLite (см. [`AGENTS.md`](../../../../AGENTS.md)).
- Архитектурные правила проекта (Clean Architecture/CQRS) и существующая структура модулей.
- Наличие/готовность UI (на первом этапе допускается минимальный web-интерфейс или API + простые страницы).

## 9. Маппинг сущностей/таблиц на доменные понятия

> Примечание: точный список таблиц и полей уточняется на этапе 1 при переносе схемы из [`backend/database/migrations/structure.sql`](../../../../backend/database/migrations/structure.sql) в Laravel-миграции.

| Доменное понятие | Таблица(ы) / сущность хранения | Комментарий |
|---|---|---|
| Пользователь (владелец дерева) | `users` | Владелец набора данных; используется для разграничения доступа. |
| Персона | `family_members` | Основная сущность человека в дереве. |
| Имя/ФИО | `family_members` (поля имени) | Хранение имени/фамилии/отчества (или эквивалентных полей) в записи персоны. |
| Связь между персонами | `relationships` | Связь «кто кому» между двумя персонами. |
| Тип связи | `relationship_types` (или справочник) | Справочник типов (родитель/ребенок/супруг и т.п.). |

## 10. Этапы

Каждый этап должен завершаться артефактами следующих стадий процесса: спецификация, планы (сводный/разработка/тесты), реализация, тесты, документация.

Артефакты этапов хранятся в каталоге этапа: либо в соответствующих поддиректориях (например, `StageN/Spec`, `StageN/Plan`, `StageN/Implementation`, `StageN/Test`, `StageN/Doc`), либо в отдельных файлах с префиксом этапа (например, `StageN_*.md`).

- Этап 1: [`Stage1.md`](Stage1.md) — Подготовка данных и «скелет» продукта (БД + базовые сущности).
- Этап 2: [`Stage2.md`](Stage2.md) — Просмотр дерева (MVP: список персон и связей).
- Этап 3: [`Stage3.md`](Stage3.md) — Управление персонами (создание/редактирование).
- Этап 4: [`Stage4.md`](Stage4.md) — Управление связями (создание/удаление/валидации).
- Этап 5: [`Stage5.md`](Stage5.md) — Минимальная визуализация дерева и улучшение UX.
- Этап 6: [`Stage6.md`](Stage6.md) — Безопасность, права доступа и готовность к демонстрации.
