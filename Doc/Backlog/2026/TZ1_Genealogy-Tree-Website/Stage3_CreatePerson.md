# Stage 3 — Управление персонами (создание)

> Источник истины по этапу: [`Stage3.md`](Doc/Backlog/2026/TZ1_Genealogy-Tree-Website/Stage3.md)

## 1. Название этапа и его краткое описание

**Этап 3 (создание):** дать пользователю возможность добавлять новых родственников.

Результат этапа должен быть демонстрируемым: пользователь может создать персону и увидеть ее в списке.

## 2. Цель этапа

- Реализовать создание персон.
- Обеспечить базовую валидацию данных, чтобы не появлялись «пустые» или некорректные записи.

## 3. Функциональные требования

- Система должна позволять пользователю **создавать персону**.
- При создании персоны пользователь должен иметь возможность указать минимум:
  - имя (обязательно, не пустое);
  - фамилию (обязательно, не пустая);
  - дату рождения (опционально);
  - дату смерти (опционально);
  - заметку/описание (опционально).
- Система должна предотвращать очевидные ошибки:
  - дата смерти не раньше даты рождения;
  - обязательные поля (имя и фамилия) не пустые.

## 4. Нефункциональные требования

- Все операции должны быть доступны только авторизованному пользователю.
- Изменения должны сохраняться надежно (без частичных записей).
- Формы должны быть простыми и понятными.
- Должно быть обеспечено **аудит/логирование изменений** по персонам.
  - Хранилище: таблица `audit_logs`.
  - Минимальные поля записи аудита: `user_id`, `action`, `timestamp`.
  - Для создания персоны фиксировать действие (например, `person.created`) и идентификатор пользователя.

## 5. UX / UI

- Форма создания доступна по URL: `/persons/create`.
- После успешного создания выполняется перенаправление на страницу персоны: `/persons/{id}`.
- Ошибки валидации отображаются на форме создания (без потери введённых пользователем данных).

## 6. Сценарии использования

1. **Пользователь добавляет родственника**
   - Открывает раздел «Персоны».
   - Нажимает «Добавить».
   - Заполняет форму и сохраняет.
   - После сохранения попадает на страницу созданной персоны.

## 7. Критерии приемки

- Можно создать персону через UI на `/persons/create`.
- После успешного создания происходит перенаправление на `/persons/{id}`.
- Валидации работают и показывают понятные сообщения на форме.
- В таблице `audit_logs` появляется запись с `user_id`, `action`, `timestamp` для события создания.

## 8. Зависимости

- Этап 2: есть просмотр списка персон и карточка персоны.

## 9. Оценка трудозатрат

- **Оценка:** 3–6 дней.
- **Основные факторы:** согласование обязательных полей, реализация проверок валидации, корректное удаление с учетом связей.
