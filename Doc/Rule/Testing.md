# Тестирование

**Особенности написания тестов**:
- Методы в тестах должны начинаться со слова test, аннотация "@test" - не работает
- Класс с тестами должен наследоваться от Tests\TestCase, а не PHPUnit\Framework\TestCase

**Когда писать тесты**:
- ✅ Все компоненты Application и Domain слоев **ОБЯЗАТЕЛЬНО** должны быть протестированы
- ❌ Тесты для конфигурации и простых DTO можно опустить (если они не содержат логики)
- ✅ Infrastructure слой (Repository, Adapter) должен быть протестирован (Integration тесты с БД)
- ✅ Presentation слой (Command, Listener) должен быть протестирован (E2E тесты)

**Минимальное требование**:
- Для каждого public метода — хотя бы один позитивный тест
- Для методов с валидацией — тесты на invalid данные
- Для методов с зависимостями — используются Mock/Stub объекты

## Типы тестов

### Unit тесты

Тестирование отдельных компонентов в изоляции (без зависимостей).

- **Расположение**: `backend/tests/Suite/{ModuleName}/Application`, `backend/tests/Suite/{ModuleName}/Domain`
- **Охватывает**:
  - Бизнес-логика в Service
  - Валидация в Validation классах
  - Логика в Domain объектах и ValueObject

### Функциональные тесты

Тестирование отдельных компонентов при взаимодействии с БД.

- **Расположение**: `backend/tests/Suite/{ModuleName}/Application/UseCase`, `backend/tests/Suite/{ModuleName}/Application/Query`, `backend/tests/Suite/{ModuleName}/Application/Command`
- **Охватывает**: 
  - Бизнес-логика в UseCase, Query, Command

### Integration тесты

Тестирование взаимодействия компонентов с внешними системами.

- **Расположение**: `backend/tests/Suite/{ModuleName}/Infrastructure`
- **Охватывает**:
  - Adapter (взаимодействие с внешними сервисами)
  - Anti-corruption layer между модулями

### End-To-End (E2E) тесты

Тестирование полного потока: от HTTP запроса до ответа, включая все слои.

- **Расположение**: `backend/tests/Suite/{ModuleName}/Presentation`
- **Охватывает**:
  - HTTP контроллеры и маршруты
  - Middleware
  - Полный жизненный цикл запроса и данных

## Инструменты и утилиты

- **PHP_CodeSniffer**: Проверка единого стиля написания кода и соблюдения стандартов кодирования
- **PHPStan**: Статический анализ кода и проверка типов
- **Rector**: Автоматическая рефакторизация и модернизация кода
- **PostgreSQL**: Используется для тестовой БД с миграциями
