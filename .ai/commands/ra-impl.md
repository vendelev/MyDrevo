# Разработай программный код

## Входные данные

$ARGUMENTS

## Алгоритм работы

### Шаг 1. Разработка кода

Вызови Task tool (switch_mode) для разработки кода:

- `subagent_type`: `implementation`
- `prompt`: "Разработай код по этапу реализации {X} из файла
  @/Doc/FeatureList/{YYYY}/{MM}/{FEATURE_FOLDER}/TaskSummary.md согласно инструкциям.
  Верни список созданных или измененных файлов для последующей проверки"

Дождись завершения работы агента и сохрани список файлов из его ответа.

### Шаг 2. Перепроверка

По окончанию работы агента вызови Task tool (switch_mode) для перепроверки:

- `subagent_type`: `implementation`
- `prompt`: "Перепроверь этап {X} из @/Doc/FeatureList/{YYYY}/{MM}/{FEATURE_FOLDER}/TaskSummary.md.
  Верни список замечаний для каждого файла"

Дождись завершения работы агента и сохрани список замечаний.

### Шаг 3. Исправление замечаний

Если найдены замечания, для каждого файла вызови отдельный Task tool (switch_mode):

- `subagent_type`: `implementation`
- `prompt`: "Внеси правки в файл {путь к файлу} согласно замечаниям: {список замечаний}"

Для уменьшения контекста каждому агенту давай задание по изменению только одного файла.

### Шаг 4. Автоматическое исправление кода и стиля

Вызови Task tool (switch_mode):

- `subagent_type`: `code-auto-fix`
- `prompt`: "Исправь код и стиль"

### Шаг 5. Проверка ошибок типов

Вызови Task tool (switch_mode):

- `subagent_type`: `phpstan`
- `prompt`: "Проверь и исправь ошибки типов"

Если агент вернул сообщение об ошибках, перезапусти подзадачу (не более 2-х раз).

### Шаг 6. Рефакторинг

Вызови Task tool (switch_mode):

- `subagent_type`: `rector`
- `prompt`: "Проверь и исправь код"

### Шаг 7. Проверка стиля кода

Вызови Task tool (switch_mode):

- `subagent_type`: `phpcs`
- `prompt`: "Проверь и исправь стиль кода"

Если агент вернул сообщение об ошибках, перезапусти подзадачу (не более 2-х раз).
