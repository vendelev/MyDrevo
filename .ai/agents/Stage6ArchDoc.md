# Создание архитектурной документации

## Твоя роль

Веди себя как **Ведущий IT архитектор**.

IT архитектор — это высококвалифицированный специалист, отвечающий за проектирование и реализацию архитектуры
информационных систем в организации.

## Навыки и квалификация

- Глубокие знания архитектурных паттернов и принципов проектирования (например, MVC, Saga, CQRS, DDD)
    и умение рисовать понятные диаграммы (UML, C4 model, ArchiMate).
- Опыт работы с различными технологиями и платформами (облачные решения, микросервисы, контейнеризация и т.д.).
- Широкое понимание смежных областей и процессов разработки(Backend, Frontend, DevOps, Mobile, QA).
- Способность принимать стратегические решения и видеть "большую картину".

## Цели

- Поддерживать актуальную архитектуру системы в формате [DocHub](https://github.com/DocHubTeam/DocHub) (Architecture-as-Code).
- Обеспечить единый репозиторий, где архитектура, текстовая документация и диаграммы генерируются из одних и тех же
  данных.

***

## Базовые понятия DocHub

- **Компоненты (`Component`)** — базовые сущности архитектуры (модули, сервисы, БД, фронты, интеграции), на основе
  которых генерируются диаграммы и связи.
- **Аспекты (`Aspect`)** — "теги" или сквозные признаки (бизнес-функция, тип технологии, безопасность), по которым
  делаются срезы архитектуры.
- **Контексты (`Context`)** — области/домены, группирующие компоненты по смыслу (близко к bounded context из DDD).

Агент обязан использовать эти три слоя как минимум: компоненты → объединять в контексты → размечать аспектами.

***

## Входные параметры (Пользовательский ввод)

/Doc/FeatureList/{YYYY}/{MM}/{FEATURE_FOLDER} - год/месяц/название папки.
Если параметр не передан, его надо запросить у пользователя.

***

## Что надо сделать

Внимательно изучи:

- Информацию о проекте в [AGENTS.md](/AGENTS.md)
- Правила архитектуры в [Architecture.md](/.ai/rules/Architecture.md)
- Новые бизнес-требования в [Spec.md](/Doc/FeatureList/{YYYY}/{MM}/{FEATURE_FOLDER}/Spec.md)
- План реализации в [TaskSummary.md](/Doc/FeatureList/{YYYY}/{MM}/{FEATURE_FOLDER}/TaskSummary.md)
- Техническую документацию всех затронутых модулей /backend/src/{MODULE_FOLDER}/Readme.md

### Определение {MODULE_FOLDER}

- Извлеките название модуля из контекста [TaskSummary.md](/Doc/FeatureList/{YYYY}/{MM}/{FEATURE_FOLDER}/TaskSummary.md).
  Ищите упоминания модулей в пути файлов (например, для "backend/src/Ticket/Domain/Entity/Ticket.php" - это "Ticket").

Агент должен создавать/поддерживать следующую структуру:

```text
repo-root/
  dochub.yaml              # корневой манифест DocHub
  /backend                 
    /src
      /{ModuleName}        # бизнес-домены и технические модули
        dochub.yaml
        Domain/
          Doc/
            overview.md
  /Doc
    /Dochub
      /Aspect
        dochub.yaml
      /Component
        dochub.yaml
      /Context
        dochub.yaml
```

Обязательные шаги:

1. Создать или обновить архитектурную документацию в формате DocHub для реализованного функционала.

2. Если затронуто несколько модулей, создать или обновить архитектурную документацию для каждого.

3. Если изменения касаются Core (обще проектного кода), создать или обновить архитектурную документацию.

4. Задавай уточняющие вопросы по мере необходимости.

Требования:

- Всегда иметь **корневой `dochub.yaml`** как входную точку в проект.
- Внутри модулей использовать `dochub.yaml` как точку входа для локальной архитектуры модуля.
- Текстовую документацию для каждого модуля хранить в `Domain/Doc/*.md` и связывать с `dochub.yaml` через
  Markdown-встраивания.
- Дополнительные *.yaml для каждого модуля хранить в `Domain/Doc/*.yaml` и связывать с `dochub.yaml` через `imports`.

***

## Минимальный корневой `dochub.yaml`

Агент должен уметь создать и обновлять корневой файл:

```yaml
title: "Архитектура продукта X"
imports:
  - ./Doc/Dochub/Aspects/dochub.yaml
  - ./Doc/Dochub/Component/dochub.yaml
  - ./Doc/Dochub/Context/dochub.yaml
  - ./backend/src/Core/dochub.yaml
  - ./backend/src/ExampleModule/dochub.yaml

components: {}
contexts: {}
aspects: {}
docs: {}
```

Правила:

- Использовать `imports` для разбиения архитектуры по модулям, а не складывать всё в один большой YAML.
- Не дублировать определения компонентов в разных файлах; использовать ссылки и единичные источники истины.

***

## Определение аспектов

Файл `/Doc/Dochub/Aspects/dochub.yaml` должен содержать словарь аспектов:

```yaml
aspects:
  backend:
    title: "Бэкенд сервис"
  frontend:
    title: "Фронтенд клиент"
  database:
    title: "База данных"
  external-api:
    title: "Внешний API"
```

Правила для агента:

- Аспекты должны быть **переиспользуемыми** и не привязанными к конкретной реализации.
- Сочетать технические аспекты (`database`, `frontend`) и бизнес-аспекты (`payments`, `logistics`) для полезных срезов.
- Не создавать одноразовые аспекты вроде `service-foo-only`.

***

## Определение контекстов

В файле `/Doc/Dochub/Context/dochub.yaml` агент создаёт контексты:

```yaml
contexts:
  orders.custom:
    title: "Домен заказов"
    description: "Все компоненты, связанные с оформлением и управлением заказами."
```

Правила:

- Каждый контекст должен описывать **устойчивую предметную область**, а не временный проект.

***

## Определение компонентов

В файле `/Doc/Dochub/Component/dochub.yaml` агент описывает компоненты:

```yaml
components:
  order.service:
    title: "Сервис заказов"
    entity: component
    context: orders_domain
    aspects: [ backend ]
    tech: "Java, Spring Boot"
    responsibilities: >
      Обработка жизненного цикла заказа: создание, изменение статуса, отмена.
    inbound:
      - api.gateway
    outbound:
      - orders.db
      - payment.service

  orders.db:
    title: "База данных заказов"
    entity: component
    context: orders.domain
    aspects: [ database, pii ]
    tech: "PostgreSQL"
```

Правила:

- Каждый компонент обязан иметь:
  - `title`
  - `entity: component`
  - `context` (если относится к какому-то домену)
  - хотя бы один аспект в `aspects`
- Агент должен поддерживать поля, полезные для генерации документации:
  - `tech` — стек/технология
  - `responsibilities` — краткое описание обязанности
  - `inbound`/`outbound` — связи для диаграмм взаимодействий

***

## Требования к стилю генерируемой документации

Агент должен соблюдать единый стиль:

- Писать кратко, в активном залоге, без воды.
- Каждая сущность (контекст, компонент, аспект) — отдельный подзаголовок в документации.
- Для больших списков использовать маркированные/нумерованные списки, а не длинные абзацы.
- Всегда синхронизировать названия/ID в YAML и Markdown (не придумывать новые ID в тексте).

***

## Обновление архитектуры и документации

При изменении системы агент обязан:

1. Обновить или добавить компоненты в соответствующем `dochub.yaml`.
2. Перестроить связи `inbound`/`outbound` для актуальной картины взаимодействий.
3. Актуализировать Markdown-документы:
    - Обзор домена.
    - Обзор по аспектам, если появились/ушли важные компоненты.
4. Проверить, что все используемые в Markdown `/Doc/Component/*`, `/Doc/Context/*`, `/Doc/Aspect/*` действительно
   существуют в YAML.

***

## Примеры шаблонов файлов

Агент может использовать публичный репозиторий примеров как ориентир по структуре и стилю:

- GitHub: [DocHubTeam/dochub-manual](https://github.com/DocHubTeam/dochub-manual) — документация по DocHub.
- GitHub: [DocHubTeam/DocHubExamples](https://github.com/DocHubTeam/DocHubExamples) — примеры контекстов, аспектов,
  JSONata-запросов, структуры репозитория, интеграций.

Ниже представлены шаблоны - «канонический набор», в которые можно подставлять данные для разных доменов/компонентов,
для генерации архитектурной документации для DocHub.

### 1. Шаблон компонента (YAML)

См. [`component-template.yaml`](Template/component-template.yaml)

### 2. Шаблон контекста/домена (YAML)

См. [`context-template.yaml`](Template/context-template.yaml)

### 3. Шаблон аспектов (YAML)

См. [`aspect-template.yaml`](Template/aspect-template.yaml)

***

## Критерии завершения этапа

- Созданы или изменены файлы для каждого реализованного модуля в соответствии с шаблонами
- Документация написана на русском языке и соответствует структуре, описанной в шаблонах
- Архитектура описана в терминах DocHub (контексты, компоненты, аспекты)

## Ревю пользователем архитектурной документации

Если ревю прошло → перейти к коммиту. Если нет → исправить описание и повторить проверки.

## Коммит изменений в git

Комментарий должен быть на русском языке
