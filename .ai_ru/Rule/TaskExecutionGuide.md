# Руководство по выполнению AI-задач

Этот документ описывает стандартный workflow для выполнения задач в любой фазе разработки.

---

## Статусная модель и переходы

### Описание статусов

| Статус | Обозначение | Описание | Когда использовать |
|--------|-------------|---------|-------------------|
| **PENDING** | `[PENDING]` | Задача еще не начата | При первом создании списка задач или когда задача отложена |
| **IN_PROGRESS** | `[IN_PROGRESS]` | Задача сейчас выполняется | Когда ИИ начинает работать над задачей |
| **COMPLETED** | `[COMPLETED]` | Задача полностью выполнена | Когда задача 100% завершена и работает корректно |

### Правила переходов между статусами

```
[PENDING] → [IN_PROGRESS] → [COMPLETED]
```

---

## Обязательные шаги для каждой задачи

### 0. Берем задачу в работу

**Меняем статус на [IN_PROGRESS]**.

Реализация кода согласно требованиям в соответствующем файле задачи.

### 1️⃣ Написание тестов (если требуются)

[Описание правил тестирования](Testing.md)

### 2️⃣ Документирование (PHPDoc)

- Добавить PHPDoc блоки для всех public методов
- Документировать параметры (@param) только для описания массивов
- Документировать возвращаемое значение (@return) только для описания массивов
- Документировать возможные исключения (@throws)

Пример:
```php
/**
 * Трансформирует DTO из API в доменную Entity.
 *
 * @param list<TicketApiDto> $dto DTO из Freshdesk API
 *
 * @return array<string, Ticket> Трансформированная сущность
 *
 * @throws InvalidTicketData Если данные не соответствуют требованиям
 */
public function transformFromApi(array $dto): array
{
    // ...
}
```

### 3️⃣ Запуск Code Fixer

Запустить автоматические фиксеры для исправления кода и стиля:

```bash
# 1. Rector - Автоматическое улучшение кода (рефакторинг, модернизация)
make php-run CMD="vendor/bin/rector process"

# 2. PHPCBF - Автоматическое исправление стиля кода (PSR-12)
make php-run CMD="vendor/bin/phpcbf"
```

**Критерии успеха**:
- ✅ Rector: Код рефакторен и изменен автоматически
- ✅ PHPCBF: Кодстиль автоматически исправлен в соответствии с файлом конфигурации

### 4️⃣ Запуск Code Quality

**После фиксеров** запустить проверки и тесты:

```bash
# 3. PHPStan - Проверка типов (0 ошибок)
make php-run CMD="vendor/bin/phpstan analyse --memory-limit=256M"

# 4. PHP_CodeSniffer - Проверка кодстиля
make php-run CMD="vendor/bin/phpcs --colors"

# 5. PHPUnit - Запуск всех тестов Ticket модуля
make php-run CMD="vendor/bin/phpunit --colors --coverage-text"
```

**Критерии успеха**:
- ✅ PHPStan: **0 ошибок**
- ✅ PHP_CodeSniffer: **0 нарушений**
- ✅ PHPUnit: **Все тесты PASSED**, код coverage ≥ 80%

## После завершения каждой задачи (перед отметкой как COMPLETED) необходимо выполнить проверку по чеклисту

```markdown
- [ ] Код реализован согласно требованиям
- [ ] Написаны все необходимые тесты
- [ ] Добавлен PHPDoc
- [ ] Выполнен запуск Code Fixer
- [ ] Выполнен запуск Code Quality
- [ ] PHP_CodeSniffer: 0 нарушений
- [ ] PHPStan: 0 ошибок
- [ ] PHPUnit: все тесты passed
- [ ] PHPDoc комментарии добавлены
- [ ] Нет очевидных ошибок или TODO

→ Когда все пункты ✅ **меняем статус на [COMPLETED]**
```
